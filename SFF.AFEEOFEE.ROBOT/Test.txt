*** Settings ***
Test Teardown     Close Browser And Kill Process
Resource          Resource/MasterKeyword.txt
Resource          Resource/MasterVariable.txt

*** Test Cases ***
00_TerminateAndChangeStatus
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    Disconnect-Terminate
    ChangeNumberToAvailiableStatus
    ChangeSIMToAvailiableStatus

01_OrderFreeRegister
    [Documentation]    step6
    OpenExcelByFile    ${ExcelFile}
    @{List}=    ReadExcel    ${ExcelSheetNameOrderFree_NewRegister}    ID Card
    OpenBrowerSericeFulfillment
    OrderFee    @{List}

02_CreateEMIE
    [Documentation]    PASS
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    CreateEMIE

03_NewRegister
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    NewRegister

04_AccountFree
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    AccountFee

testRun
    RunRandomID

02ChageChargeType
    [Documentation]    เบอร์ pre paid
    Comment    OpenExcelByFile    ${ExcelFile}
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    CreateEMIE
    OpenExcelByFile    Excel.xlsx
    GoToCustomerService
    @{List}=    ReadExcel    ${ExcelSheetName_ChangeChargeType_Pre}    ${ChangeChargeType_IDCard}
    OrderFee_ChangeChargeType    @{List}
    Comment    Open Excel File    D:\\Soraya\\P4_AutomateTesting\\AISOnIE\\AIS\\Log.xlsx
    Comment    PutImageToExcel

03Terminate
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    Disconnect-Terminate
    Comment    ${Actual}    Get Text    xpath=//span[@class='rich-messages-label']
    Comment    Should Not Contain    ${Actual}    JTA

04ChangeNumberToAvailiableStatus
    [Documentation]    After Terminate Number
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    ChangeNumberToAvailiableStatus

05ChangeSIMToAvailiableStatus
    [Documentation]    PASS
    OpenExcelByFile    ${ExcelFile}
    OpenBrowerSericeFulfillment
    ChangeSIMToAvailiableStatus

TestIE
    Process.Run Process    Taskkill /IM IEDriverServer.exe /F    shell=True
    Comment    Open Browser    https://sffsit.ais.co.th:8103/SFFWeb/pages/home/portal.jsf    ie
    Comment    Open Browser    https://www.google.co.th    ie
    IEDriver
    Comment    GoToAssetInformation    https://localhost/
    GoToAssetInformation    https://sffsit.ais.co.th:8103/SFFWeb/pages/home/portal.jsf
    Comment    Wait Until Element Is Visible    xpath=//a[@id='overridelink']
    Comment    Click Element    xpath=//a[@id='overridelink']
    ${Status}=    Run Keyword And Return Status    Wait Until Element Is Visible    xpath=//a[@name='overridelink'][contains(text(),'Continue to this website (not recommended).')]
    Run Keyword If    ${Status}==True    Click Element    xpath=//a[@name='overridelink'][contains(text(),'Continue to this website (not recommended).')]
    Wait Until Page Contains Element    xpath=//input[@name='frm:username']
    Comment    Input Text    xpath=//input[@name='frm:username']    ${UserID01}
    Comment    Input Password    xpath=//input[@name='frm:password']    ${Password}
    Comment    Click Element    xpath=//input[@class='rich-button']
    Close Browser
    Comment    Process.Run Process    Taskkill /IM IEDriverServer.exe /F    shell=True

TestDataBase
    Connect To Database Using Custom Params    cx_Oracle    'sudkaj49','Ais#1234','172.16.249.77:1536/sffsitdb'
    Comment    ${queryResult}    Query    select * from \ SFF_account
    Comment    Log    ${queryResult[0][1]},${queryResult[0][0]}

TestFile
    ${ListPicture}    List Files In Directory    ${PathFile}${FolderOrderFree}
    Comment    ${ListPicture}    List Files In Directory    C:\\Python27\\AIS\\ORDERFREE    *OrderFreeStep*.png
    Sort List    ${ListPicture}
    OpenExcelByFile    CaptureOrderFreeResult.xlsx
    Comment    Create File    C:\\Python27\\AIS\\CaptureOrderFreeResult.xlsx
    ${gap}    Set Variable    3
    ${ListIndex}    Get Length    ${ListPicture}
    : FOR    ${i}    IN RANGE    0    ${ListIndex}
    \    CustomXlsxLibrary.Put String To Cell    Sheet1    B${gap}    ${ListPicture[${i}]}
    \    ${gap}    Evaluate    ${gap}+${2}
    \    CustomXlsxLibrary.Put Image To Cell    Sheet1    B${gap}    C:\\Python27\\AIS\\ORDERFREE\\${ListPicture[${i}]}
    \    ${gap}    Evaluate    ${gap}+${100}
    CustomXlsxLibrary.Save Excel    C:\\Python27\\AIS\\CaptureOrderFreeResult.xlsx

TestExcelFile
    OpenExcelByFile    ${ExcelFile}

SendEmail
    Run Process    Taskkill /IM IEDriverServer.exe /F    shell=True
    Run Process    ${CURDIR}\\SendEmail.bat    shell=True

ConvertToJSON
    OpenExcelByFile    AccoutFreeEmail.xlsx
    @{No}    ReadExcel    AccoutFreeEmail    No
    @{ProductName}    ReadExcel    AccoutFreeEmail    Product Name
    @{IDcardNo}    ReadExcel    AccoutFreeEmail    ID Card No
    @{CANo}    ReadExcel    AccoutFreeEmail    CA No
    @{BANo}    ReadExcel    AccoutFreeEmail    BA No
    @{MobileNo}    ReadExcel    AccoutFreeEmail    Mobile No
    @{OrderNo}    ReadExcel    AccoutFreeEmail    Order No
    @{InstallmentFlag}    ReadExcel    AccoutFreeEmail    Installment Flag
    ${ListIndex}    Get Length    ${No}
    ${proxy}    Create Dictionary
    Set To Dictionary    ${proxy}    PRNo    PR-20161155
    Set To Dictionary    ${proxy}    PRDate    05/10/2016
    @{array}    Create List
    : FOR    ${i}    IN RANGE    0    ${ListIndex}
    \    ${tempData}    Create Dictionary
    \    Set To Dictionary    ${tempData}    No    ${No[${i}]}
    \    Set To Dictionary    ${tempData}    ProductName    ${ProductName[${i}]}
    \    Set To Dictionary    ${tempData}    IDCardNo    ${IDcardNo[${i}]}
    \    Set To Dictionary    ${tempData}    CANo    ${CANo[${i}]}
    \    Set To Dictionary    ${tempData}    BANo    ${BANo[${i}]}
    \    Set To Dictionary    ${tempData}    MobileNo    ${MobileNo[${i}]}
    \    Set To Dictionary    ${tempData}    OrderNo    ${OrderNo[${i}]}
    \    Set To Dictionary    ${tempData}    InstallmentFlag    ${InstallmentFlag[${i}]}
    \    Append To List    ${array}    ${tempData}
    Log    ${array}
    Set To Dictionary    ${proxy}    ListPayment    ${array}    #
    ${json_single}    Evaluate    json.dumps(${proxy})    json
    Create File    D:\\Soraya\\P4_AutomateTesting\\AISOnIE\\AIS\\test.json    ${json_single}

TestExcel
    Open Excel File    D:\\Soraya\\P4_AutomateTesting\\AISOnIE\\AIS\\Log.xlsx
    ${NamePic}    List Files In Directory    D:\\Soraya\\P4_AutomateTesting\\AISOnIE\\AIS\\ORDERFREE    *OrderFreeStep*.png
    ${GetLeangeName}=    Get Length    ${NamePic}
    ${ga}    Set Variable    1
    : FOR    ${i}    IN RANGE    0    ${GetLeangeName}
    \    ${gapic}    Evaluate    ${ga}+${5}
    \    CustomXlsxLibrary.Put String To Cell    Sheet1    A${ga}    1101
    \    ${RowCount}=    Get Rows Count    Sheet1
    \    ${ColumnCount}=    Get Columns Count    Sheet1
    \    Put Image To Cell    Sheet1    A${gapic}    D:\\Soraya\\P4_AutomateTesting\\AISOnIE\\AIS\\ORDERFREE\\${NamePic[${i}]}
    \    ${ga}    Evaluate    ${ga}+${50}
    CustomXlsxLibrary.Save Excel    D:\\Soraya\\P4_AutomateTesting\\AISOnIE\\AIS\\Log.xlsx
